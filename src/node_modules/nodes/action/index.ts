
import * as def from '../def';
import * as bb from 'bluebird';
import Action from './action';
import * as wm from './wmcloud';
import * as rtplan from './rtplan';
import * as hypo from './hypothesis';

export function resolve(action: { type: string, pack?: any }, task: def.Task): bb<void> {
    return bb.resolve()
        .then(() => {
            const acthandler = actmap.get(action.type);
            if (acthandler == null) return bb.reject(new Error(`action not found for type: ${action.type}`));
            else return acthandler.resolve(action.pack);
        });
}

export function validate(action: { type: string, pack?: any }): boolean {
    const acthandler = actmap.get(action.type);
    return acthandler != null && acthandler.validate(action.pack);
}

const actmap = new Map<string, Action<any, any, any>>();
actmap.set('rawinspect', wm.inspect.action);
actmap.set('rawsync', wm.sync.action);
actmap.set('rawdata', wm.raw.action);
actmap.set('stocklist', wm.stocklist.action);
actmap.set('simulate', rtplan.simulate.action);
actmap.set('simall', rtplan.simall.action);
actmap.set('hypotest', hypo.test.action);
actmap.set('hypotestaggr', hypo.aggr.action);
