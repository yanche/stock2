
import * as def from '../def';
import * as bb from 'bluebird';

export interface Action {
    resolve(pack: any, task: def.Task): bb<void>;
    validate(pack: any): boolean;
}

export function resolve(action: { type: string, pack: any }, task: def.Task): bb<void> {
    return bb.resolve()
        .then(() => {
            const acthandler = actmap.get(action.type);
            if (acthandler == null) return bb.reject(new Error(`action not found for type: ${action.type}`));
            else return acthandler.resolve(action.pack, task);
        });
}

export function validate(action: { type: string, pack: any }): boolean {
    const acthandler = actmap.get(action.type);
    return acthandler != null && acthandler.validate(action.pack);
}

const actmap = new Map<string, Action>();