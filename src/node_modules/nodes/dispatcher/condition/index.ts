
import * as bb from 'bluebird';

export interface Condition {
    resolve(pack: any): bb<boolean>;
    validate(pack: any): boolean;
}

export function resolve(cond: { type: string, pack: any }): bb<boolean> {
    return bb.resolve()
        .then(() => {
            const condhandler = condmap.get(cond.type);
            if (condhandler == null) return bb.reject(new Error(`condition not found for type: ${cond.type}`));
            else return condhandler.resolve(cond.pack);
        });
}

export function validate(cond: { type: string, pack?: any }): boolean {
    const condhandler = condmap.get(cond.type);
    return condhandler != null && condhandler.validate(cond.pack);
}

const condmap = new Map<string, Condition>();
