
import * as utility from 'utility';
import * as bb from 'bluebird';

// export interface HandlerDataModel {
//     validate(): boolean;
//     toMongoDoc(): any;
// }

function objIdfy(obj: any): any {
    const ret: { [name: string]: any } = {};
    for (var i in obj) {
        ret[i] = (i === '_id') ? utility.mongo.objIdfy(obj[i]) : obj[i];
    }
    return ret;
}

function genGetOneHandler(colc: utility.mongo.CollClient) {
    return (hpack: utility.http.HttpPack) => new bb<void>((res, rej) => {
        const body = hpack.reqbody;
        const filter = body.filter || {};
        const fields = body.fields;
        if (!utility.validate.isObj(filter) || (fields != null && !utility.validate.isObj(fields)))
            hpack.status = 400;
        else {
            colc.getOne(objIdfy(filter), fields).then(task => {
                if (task) hpack.body = task;
                else hpack.status = 404;
            });
        }
    });
}
