
import * as utility from 'utility';

const dateMS = 1000 * 60 * 60 * 24;
export function dateTs(year: number, month: number, date: number): number {
    var d = new Date(Date.UTC(year, month, date, 0, 0, 0, 0));
    if (d.getUTCDate() !== date || d.getUTCMonth() !== month || d.getUTCFullYear() !== year) throw new Error(`bad data for date-ts: ${year}-${month}-${date}`);
    return d.getTime() / dateMS;
}

export function dateKey2DateTs(datestr: string): number {
    if (datestr == null || datestr.length !== 10 || datestr[4] !== '-' || datestr[7] !== '-') throw new Error(`bad format of date-string, ${datestr}`);
    var year = Number(datestr.slice(0, 4)), month = Number(datestr.slice(5, 7)), date = Number(datestr.slice(8));
    if (!utility.validate.nonNegNum(year, true) || !utility.validate.nonNegNum(month, true) || !utility.validate.nonNegNum(date, true)) throw new Error(`bad format of date-string, ${datestr}`);
    return dateTs(year, month, date);
}

export function dateOffset(date: Date | number, options: { year?: number, month?: number, day?: number, hour?: number, minute?: number, second?: number, ms?: number }): Date {
    var ret = typeof date === 'number' ? new Date(date) : new Date(Date.UTC(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds(), date.getUTCMilliseconds()));
    if (options.year != null) ret.setUTCFullYear(ret.getUTCFullYear() + options.year);
    if (options.month != null) ret.setUTCMonth(ret.getUTCMonth() + options.month);
    if (options.day != null) ret.setUTCDate(ret.getUTCDate() + options.day);
    if (options.hour != null) ret.setUTCHours(ret.getUTCHours() + options.hour);
    if (options.minute != null) ret.setUTCMinutes(ret.getUTCMinutes() + options.minute);
    if (options.second != null) ret.setUTCSeconds(ret.getUTCSeconds() + options.second);
    if (options.ms != null) ret.setUTCMilliseconds(ret.getUTCMilliseconds() + options.ms);
    return ret;
}
